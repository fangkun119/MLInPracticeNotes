# 电力窃漏电用户自动识别

## 1. 背景

传统人工稽查：

* 数据来源：计量异常报警功能、电能量数据查询
* 数据采集：电量异常、负荷异常、终端报警、主站报警、线损异常
* 缺陷：终端误报漏报、专家知识依赖

模型自动识别：

* 数据来源：电力计量自动化系统
* 特征数据：电流、电压、功率因数
* 标签数据：用电异常终端报警、人工稽查

数据样本：

* 大用户用电负荷数据
  > 用户编号、时间(每个时间点代表15秒的采样区间）、有功总功率、A相有功功率、B相有功功率、C相有功功率、电流A相、电流B相、电流C相、电压A相、电压B相、电压C相、功率因数、功率因数A、功率因数B、功率因数C

* 大用户终端报警信息：
  > 用户名称、时间(报警时间点)、计量点、报警编号（名称编号）、报警名称（原因）

* 大用户违约、窃电处理通知书：
  > 现场情况、窃电行为、计算方法及依据

## 2. 目标

* 归纳关键特征、构建识别模型
* 实时监测和诊断

## 3. 分析

### 数据观察：

1. 某些大用户也不可能存在窃漏电行为，如银行、税务、学校等非居民类别，应当从数据中剔除
2. 终端报警存在很多误报和漏报的情况，需要进行数据探索和处理

### 步骤：

1. 数据抽取
2. 数据分析：用户白名单过滤、初步审视数据和用电特征
3. 数据预处理：数据清洗、缺失值处理、数据变换
4. 构造专家样本集
5. 构建窃电用户识别模型
6. 在线监测用户用电负荷及终端报警、实现实时诊断

## 4. 数据抽取：

来自营销系统的数据

* 用户信息： 用户名称、用户编号、用电地址、用电类别、报装容量、计量方式、电流互感器变比、电压互感器变比
* 违约、窃电处理记录
* 计量方法及依据

来自从计量自动化系统的数据

* 时间点、计量点、总有功功率、A/B/C相有功功率、A/B/C相电流、A/B/C相电压、A/B/C相功率因数
* 终端报警

> 数据采集：<br/>
> (1) 要包含不同类型的窃漏电用户、以及部分正常用户，以便能覆盖完全<br/>
> (2) 要包含 [窃电开始时间, 窃电结束时间] 区间段的数据；也要包含这个区间段前后一定范围的数据<br/>
> (3) 要包含当日用户的用电量（当日所有15分钟总有功功率求和：f<sub>day</sub> = 0.25 SUM(m<sub>idx_of_each_15min</sub>)）<br/>

## 5. 数据分析：

> 探索数据内在的规律特征、有助于选择合适的预处理和分析技术

### (1).分布分析

分析窃漏电用户分布，发现有窃漏电用户的类别是：大工业、非工业、居民生活、农业生产、普通工业、商业
没有切漏电行为的用户类别是：非居民（包括银行、税务、学校等），固接下来不考虑该类别的用电数据

### (2).周期性分析

发现正常用户的用电量周期明显、用电量周期稳定；窃电用户用电量持续下降

## 6. 数据预处理：

### (1).数据筛选

根据业务和建模的需要，筛选出需要的数据。本项目中：（1）选用发生过窃电行为的用户类别；（2）选用工作日数据（节假日数据明显偏低）

### (2).缺失值处理

避免线损（供入电量-供出电量）率数据误差过大，采用拉格朗日插值法对数据进行插补

[代码6-1 拉格朗日插值代码](code/6-1_Lagrange_interpolation.py)

### (3).数据变换

电量、负荷等指标特征不够明显，需要构造更加明显的特征，包括如下指标：

* 电量趋势下降指标：用电量指标

	> 正常用户用电量平稳、窃漏电用户用电量周期下降随后平稳<br/>
	> 考虑前后几天作为窗口期，考虑期间的下降趋势，利用电量做直线拟合得到的斜率作为衡量指标<br/>
	> 如果斜率随时间不断下降，那么用户窃电的可能就增大
	
	![05_electric_power_stealing_01_power_consumption_amount](img/05_electric_power_stealing_01_power_consumption_amount.jpg)
	
	本项目以5天作为窗口期，计算11天内的电量趋势下降情况

* 线损（供入电量-供出电量）指标：线损增长率
	
	> 用户所属电路的线损率
	> 
	> * 一条电路为多个用户供电
	> * 该电路线损量为：供入电量 - 线路上所有用户用电量之和
	> * 该电路线损率为：线损量 / 供入电量
	> 
	> 发生切漏电时、线损率会上升；由于用户每天用电量存在波动、单纯以当天线损率上升作为切漏电特征则无差过大，需要考虑前后几天线损率平均值、判断其增长率是否大于1%<br/>
	
	本项目以5天作为统计窗口期，计算前5天的线损率平均值V<sub>i,1</sub>，当前与后5天的线损率平均值V<sub>i,2</sub>。若(V<sub>i,2</sub> - V<sub>i,1</sub>)/V<sub>i,1</sub> > 1，认为有窃电嫌疑，特征值为1；反之特征值为0

* 告警类指标：与切漏电相关的终端告警数

	> 包括：电压缺项、电压断项、电流反极性等<br/>
	> 计算发生与窃漏电相关的终端报警的次数总和，作为告警类指标

## 7. 专家样本库

字段包括：日期，用户编号，电量趋势下降指标，线损指标，告警类指标，是否切漏电<br/>
专家样本数据：(data/model.xls](data/model.xls)


## 8. 模型构建

### 数据划分

20%测试集，80%训练集

### 模型

LM神经网络: [构建LM神经网络模型代码](code/6-3_lm_model.py)
CART决策树: [构建CART决策树模型代码](code/6-2_dt_model.py)

### 模型评价

分类准确率，混淆矩阵，ROC 

### 模型诊断

与稽查结果对比，识别出的10个切漏电用户中，误判为1，但是有4个切漏电用户未被发现<br/>
接下来需要提高召回率<br/>








